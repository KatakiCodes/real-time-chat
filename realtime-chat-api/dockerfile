# Dockerfile para API .NET 9 (multi-stage)
FROM mcr.microsoft.com/dotnet/sdk:9.0 AS build
WORKDIR /src

# Copia todo o código (menos o que estiver em .dockerignore) e restaura dependências
COPY . .
RUN dotnet restore

# Publica em Release para a pasta /app/publish
RUN dotnet publish -c Release -o /app/publish

FROM mcr.microsoft.com/dotnet/aspnet:9.0 AS runtime
WORKDIR /app

# Expõe apenas a porta HTTPS 5001
EXPOSE 5001

# Força a aplicação a escutar na porta HTTPS 5001 (Kestrel)
ENV ASPNETCORE_URLS=https://+:5001

# Copia artefatos publicados da etapa de build
COPY --from=build /app/publish ./

# Ajuste o nome do DLL abaixo se necessário (substitua MyApi.dll pelo nome real)
ENTRYPOINT ["dotnet", "realtime-chat-api.dll"]
